<ion-header class="ion-no-border">
  <ion-toolbar class="main-header">
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/tabs/news"></ion-back-button>
    </ion-buttons>
    <ion-title>My Profile</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="toggleEdit()" [color]="isEditing ? 'medium' : 'primary'">
        <ion-icon slot="start" [name]="isEditing ? 'close-outline' : 'create-outline'"></ion-icon>
        {{ isEditing ? 'Cancel' : 'Edit' }}
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="profile-content">
  <div class="background-blob"></div>

  <div class="profile-header ion-text-center">
    <div class="avatar-wrapper" (click)="changeProfilePicture()" [class.editable]="isEditing">
      <img [src]="user?.avatarUrl || 'https://ionicframework.com/docs/img/demos/avatar.svg'" alt="Avatar" />
      @if (isEditing) {
      <div class="edit-avatar-badge">
        <ion-icon name="camera"></ion-icon>
      </div>
      }
    </div>
    @if (user) {
    <h2>{{ user.name }}</h2>
    <p class="email-text">{{ user.email }}</p>
    <div class="member-badge">
      <ion-icon name="shield-checkmark-outline"></ion-icon>
      <span>Premium Member</span>
    </div>
    }
  </div>

  <div class="profile-card">
    <!-- Personal Details -->
    <div class="section-title">Personal Details</div>

    @if (user) {
    <div class="input-group">
      <ion-item lines="none" class="custom-item" [class.readonly]="!isEditing">
        <ion-icon name="person-outline" slot="start"></ion-icon>
        <ion-input label="Full Name" labelPlacement="stacked" [(ngModel)]="user.name" type="text"
          placeholder="Enter your name" [readonly]="!isEditing"></ion-input>
      </ion-item>

      <ion-item lines="none" class="custom-item" [class.readonly]="!isEditing">
        <ion-icon name="mail-outline" slot="start"></ion-icon>
        <ion-input label="Email Address" labelPlacement="stacked" [(ngModel)]="user.email" type="email"
          placeholder="Enter your email" [readonly]="!isEditing"></ion-input>
      </ion-item>
    </div>
    }

    <!-- Security & Preferences -->
    <div class="section-title">Security & Preferences</div>

    <div class="input-group">
      <ion-item lines="none" class="custom-item toggle-item">
        <ion-icon name="finger-print-outline" slot="start"></ion-icon>
        <ion-label>
          <h2>Biometric Login</h2>
          <p>Use FaceID or TouchID</p>
        </ion-label>
        <ion-toggle [(ngModel)]="biometricsEnabled" (ionChange)="toggleBiometrics()" slot="end"></ion-toggle>
      </ion-item>

      <ion-item lines="none" class="custom-item toggle-item">
        <ion-icon name="notifications-outline" slot="start"></ion-icon>
        <ion-label>
          <h2>Push Notifications</h2>
          <p>Breaking news alerts</p>
        </ion-label>
        <ion-toggle [(ngModel)]="notificationsEnabled" (ionChange)="toggleNotifications()" slot="end"></ion-toggle>
      </ion-item>
    </div>

    <!-- About Section -->
    <div class="section-title">About</div>

    <div class="input-group about-group">
      <ion-item lines="none" class="custom-item about-item" button="true" (click)="openSettings()">
        <ion-icon name="settings-outline" slot="start"></ion-icon>
        <ion-label>
          <h2>Settings</h2>
        </ion-label>
        <ion-icon name="chevron-forward-outline" slot="end" class="chevron-icon"></ion-icon>
      </ion-item>

      <ion-item lines="none" class="custom-item about-item" button="true" (click)="openPrivacyPolicy()">
        <ion-icon name="shield-checkmark-outline" slot="start"></ion-icon>
        <ion-label>
          <h2>Privacy Policy</h2>
        </ion-label>
        <ion-icon name="chevron-forward-outline" slot="end" class="chevron-icon"></ion-icon>
      </ion-item>

      <ion-item lines="none" class="custom-item about-item" button="true" (click)="openLicenses()">
        <ion-icon name="code-slash-outline" slot="start"></ion-icon>
        <ion-label>
          <h2>Open Source Licenses</h2>
        </ion-label>
        <ion-icon name="chevron-forward-outline" slot="end" class="chevron-icon"></ion-icon>
      </ion-item>
    </div>

    @if (isEditing) {
    <ion-button expand="block" (click)="saveChanges()" class="save-btn ion-margin-top">
      <ion-icon slot="start" name="shield-checkmark-outline"></ion-icon>
      Save Changes
    </ion-button>
    }

    <!-- Logout Button -->
    <ion-button expand="block" fill="outline" color="danger" (click)="logout()" class="logout-btn">
      <ion-icon slot="start" name="log-out-outline"></ion-icon>
      Sign Out
    </ion-button>

    <div class="version-info ion-text-center ion-margin-top">
      <p>LE News v1.0.0</p>
    </div>

  </div>
</ion-content>